<!DOCTYPE html>
<html>
  <head>
    <title>FileWriter Example</title>

    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" charset="utf-8">

    // Wait for PhoneGap to load
    //
    function onBodyLoad() {
                document.addEventListener("deviceready", onDeviceReady, false);
            }

    // PhoneGap is ready
    //
    function onDeviceReady() {
	    navigator.notification.alert("PhoneGap is ready!");
        document.getElementById("createFile").addEventListener("click", createFile);
document.getElementById("writeFile").addEventListener("click", writeFile);
document.getElementById("readFile").addEventListener("click", readFile);
document.getElementById("removeFile").addEventListener("click", removeFile);
	    window.requestFileSystem(LocalFileSystem.TEMPORARY,
5242880, listPath, onFileError);
    }

   function createFile() {
   var type = window.TEMPORARY;
   var size = 5*1024*1024;
  window.requestFileSystem(type, size, successCallback, errorCallback)

   function successCallback(fs) {
      fs.root.getFile('practica.txt', {create: true, exclusive: true}, function(fileEntry) {
         alert('File creation successfull! ' + fs.root.fullPath +' jgj')
      }, errorCallback);
   }

   function errorCallback(error) {
      alert("ERROR: " + error.code)
   }
	
}
      function writeFile() {
   var type = window.TEMPORARY;
   var size = 5*1024*1024;
   window.requestFileSystem(type, size, successCallback, errorCallback)

   function successCallback(fs) {
      fs.root.getFile('practica.txt', {create: true}, function(fileEntry) {

         fileEntry.createWriter(function(fileWriter) {
            fileWriter.onwriteend = function(e) {
               alert('Write completed. '+ fileEntry.metadata.modificationTime);
            };

            fileWriter.onerror = function(e) {
               alert('Write failed: ' + e.toString());
            };

            var blob = new Blob(['practica practica practica'], {type: 'text/plain'});
            fileWriter.write(blob);
         }, errorCallback);
      }, errorCallback);
   }

   function errorCallback(error) {
      alert("ERROR: " + error.code)
   }
}
      function readFile() {
   var type = window.TEMPORARY;
   var size = 5*1024*1024;
   window.requestFileSystem(type, size, successCallback, errorCallback)

   function successCallback(fs) {
      fs.root.getFile('practica.txt', {}, function(fileEntry) {

         fileEntry.file(function(file) {
            var reader = new FileReader();

            reader.onloadend = function(e) {
               var txtArea = document.getElementById('textarea');
               txtArea.value = this.result;
            };
            reader.readAsText(file);
         }, errorCallback);
      }, errorCallback);
   }

   function errorCallback(error) {
      alert("ERROR: " + error.code)
   }
}
      function removeFile() {
   var type = window.TEMPORARY;
   var size = 5*1024*1024;
   window.requestFileSystem(type, size, successCallback, errorCallback)

   function successCallback(fs) {
      fs.root.getFile('practica.txt', {create: false}, function(fileEntry) {

         fileEntry.remove(function() {
            alert('File removed.');
         }, errorCallback);
      }, errorCallback);
   }

   function errorCallback(error) {
      alert("ERROR: " + error.code)
   }
}
	    function onGetFileSystemSuccess(fs) {
alert("Accessing " + fs.name + " storage (" +
fs.root.fullPath + ")");
//Create a directory reader we'll use to list the files in
//the directory
var dr = fs.root.createReader();
// Get a list of all the entries in the directory
dr.readEntries(onDirReaderSuccess, onFileError);
}
	    function onDirReaderSuccess(dirEntries) {
var i, fl, len;
len = dirEntries.length;
if(len > 0) {
fl = '<ul data-role="listview">';
for( i = 0; i < len; i++) {
if(dirEntries[i].isDirectory == true) {
fl += '<li><a href="#" onclick="processEntry(' + i +
');">Directory: ' + dirEntries[i].name + '</a></li>';
} else {
fl += '<li><a href="#" onclick="processEntry(' + i +
');">File: ' + dirEntries[i].name + '</a></li>';
}
}fl += "</ul>";
} else {
fl = "<p>No entries found</p>";
}
//Update the page content with our directory list
$('#dirEntries').html(fl);
//Display the directory entries page
$.mobile.changePage("#dirList", "slide", false, true);
}
	    function onFileError(e) {
var msgText;
switch(e.code) {
case FileError.NOT_FOUND_ERR:
msgText = "File not found error.";
break;
case FileError.SECURITY_ERR:
msgText = "Security error.";
break;
case FileError.ABORT_ERR:
msgText = "Abort error.";
break;
case FileError.NOT_READABLE_ERR:
msgText = "Not readable error.";
break;
case FileError.ENCODING_ERR:
msgText = "Encoding error.";
break;
case FileError.NO_MODIFICATION_ALLOWED_ERR:
msgText = "No modification allowed.";
break;
case FileError.INVALID_STATE_ERR:
msgText = "Invalid state.";
break;
case FileError.SYNTAX_ERR:
msgText = "Syntax error.";
break;
case FileError.INVALID_MODIFICATION_ERR:
msgText = "Invalid modification.";
break;
case FileError.QUOTA_EXCEEDED_ERR:
msgText = "Quota exceeded.";
break;
case FileError.TYPE_MISMATCH_ERR:
msgText = "Type mismatch.";
break;
case FileError.PATH_EXISTS_ERR:
msgText = "Path exists error.";
break;
default:
msgText = "Unknown error.";
}
//Now tell the user what happened
navigator.notification.alert(msgText, null, "File Error");
}
	    function listPath(myPath){
  window.resolveLocalFileSystemURL(myPath, function (dirEntry) {
       var directoryReader = dirEntry.createReader();
       directoryReader.readEntries(onSuccessCallback,onFailCallback);
  });

  function onSuccessCallback(entries){
       for (i=0; i<entries.length; i++) {
           var row = entries[i];
           var html = '';         
           if(row.isDirectory){
                 // We will draw the content of the clicked folder
                 html = '<li onclick="listPath('+"'"+row.nativeURL+"'"+');">'+row.name+'</li>';
           }else{
                 // alert the path of file
                 html = '<li onclick="getFilepath('+"'"+row.nativeURL+"'"+');">'+row.name+'</li>';
           }
       
       }
                
        document.getElementById("select-demo").innerHTML = html;
  }

  function onFailCallback(e){
    console.error(e);
    // In case of error
  }
}

function getFilepath(thefilepath){
        alert(thefilepath);
}
    </script>
  </head>
  <body onload="onBodyLoad()">
    <h1>Example</h1>
    <button id = "createFile">CREATE FILE</button>
<button id = "writeFile">WRITE FILE</button>
<button id = "readFile">READ FILE</button>
<button id = "removeFile">DELETE FILE</button>
<textarea id = "textarea"></textarea>
	  <div>
  <ul id="select-demo">
    
  </ul>
</div>
  </body>
</html>
